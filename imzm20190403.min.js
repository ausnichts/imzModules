var imzModules=function(){var e=function(){this.linkBlank=arguments[0].linkBlank||!1,this.mvBgImg=arguments[0].mvBgImg||!1,this.chgFeturedImg=arguments[0].chgFeturedImg||!1,this.pageArchive=arguments[0].pageArchive||!1,this.scrNavi=arguments[0].scrNavi||!1,this.mvCategory=arguments[0].mvCategory||!1,this.addHistoryBack=arguments[0].addHistoryBack||!1,this.chgBCLink=arguments[0].chgBCLink||!1};return e.prototype.init=function(){var e=document.body.classList;if(this.linkBlank){var t=new RegExp("^http(s)?://(?!"+location.hostname+")"),a=document.getElementsByTagName("a");Array.prototype.forEach.call(a,function(e){t.test(e.href)&&e.setAttribute("target","_blank")})}if(this.mvBgImg&&e.contains("header-image-enable")){var n=document.getElementById("blog-title-inner"),o=n.getAttribute("style").replace(/background-position.*?;/,"");n.removeAttribute("style"),document.getElementById("blog-title").setAttribute("style",o)}var r=this.pageArchive?"page-archive":"page-index";if(this.chgFeturedImg&&e.contains(r)){var i=document.getElementsByClassName("entry-thumb"),s=/https%3A%2F%2F.+\.(jpg|jpeg|gif|png|bmp)/i;Array.prototype.forEach.call(i,function(e){var t=s.exec(e.getAttribute("style"));null!==t&&(e.style.backgroundImage="url("+decodeURIComponent(t[0])+")")})}if(this.scrNavi){for(var l=document.getElementById("wrapper"),c=['<li><a href="javascript:void(0);" onclick="smoothScroll(0);"><i class="blogicon-chevron-up"></i></a></li>','<li><a href="javascript:void(0);" onclick="scrollToContent(\'imz-smoothscroll\');"><i class="blogicon-chevron-down"></i></a></li>','<li><a href="/"><i class="blogicon-home"></i></a></li>'],m=document.createElement("ul"),d=0;d<c.length;d++)m.insertAdjacentHTML("beforeend",c[d]);m.classList.add("imzScroll"),document.getElementById("bottom-editarea").appendChild(m);var g=l.getElementsByClassName("table-of-contents")[0];if(void 0!==g){a=g.getElementsByTagName("a");Array.prototype.forEach.call(a,function(e){e.setAttribute("onclick","javascript:scrollToContent('"+e.getAttribute("href")+"')"),e.setAttribute("href","javascript:void(0)")})}var u=document.createElement("div");u.id="imz-smoothscroll",l.appendChild(u)}var p=document.getElementsByClassName("hatena-module-category")[0],f=document.getElementById("top-editarea-inner");if(this.mvCategory&&void 0!==p&&null!==f){var h=p.getElementsByClassName("hatena-urllist")[0];h.classList.remove("hatena-urllist"),h.classList.add("imzMenu");a=h.getElementsByTagName("a");Array.prototype.forEach.call(a,function(e){e.textContent=e.textContent.replace(/\s\(([0-9]{1,})\)/,"")}),f.appendChild(h),p.style.display="none"}if(this.addHistoryBack&&-1!==location.href.indexOf(location.hostname+"/?page=")){var v=document.getElementsByClassName("pager")[0],y=document.createElement("span");if(-1!==document.referrer.indexOf(document.domain))var b='<a href="#" onClick="history.back(); return false;">前のページ</a>';else b='<a href="/">ホーム</a>';y.innerHTML=b,y.classList.add("pager-prev"),v.insertBefore(y,v.firstChild)}if(this.chgBCLink){var B=document.getElementsByTagName("article")[0];if(void 0!==B){var E=B.getElementsByTagName("iframe");t=new RegExp("http(s)?%3A%2F%2F"+location.hostname+".+$");Array.prototype.forEach.call(E,function(e){var a=t.exec(e.src);if(null!==a){if(e.src="",-1!==a[0].indexOf("entry"))var n=decodeURIComponent(a[0]).replace("entry","embed"),o=!0;else n=decodeURIComponent(a[0]),o=!1;(function(e,t){return new Promise((a,n)=>{const o=new XMLHttpRequest;o.open(t||"GET",e,!0),o.onload=(()=>a(o.responseText)),o.onerror=(()=>n(o.statusText)),o.send()})})(n).then(e=>(function(e,t,a){var n=(new DOMParser).parseFromString(e,"text/html");if(t){var o=(g=n.getElementsByClassName("embed-wrapper")[0]).getElementsByTagName("time");void 0!==o&&o[0].removeAttribute("data-relative");var r=g.getElementsByTagName("a");Array.prototype.forEach.call(r,function(e){e.setAttribute("target","_top")})}else{for(var i=n.getElementsByTagName("meta"),s={},l=/og:(.+)/,c=0;c<i.length;c++){var m=i[c].getAttribute("property");if(null!==m){var d=m.match(l);null!==d&&(s[d[1]]=i[c].getAttribute("content"))}}var g;l=/(.+) - .+/,s.title=s.title.match(l)[1],s.site_url=a.split("/")[2],s.description=s.description.substr(0,100)+"...",(g=document.createElement("div")).classList.add("embed-wrapper"),g.innerHTML='<div class="embed-wrapper-inner"><div class="embed-content with-thumb"><div class="thumb-wrapper"><a href="'+a+'" target="_top"><img src="'+s.image+'" class="thumb"></a></div><div class="entry-body"><h2 class="entry-title"><a href="'+a+'" target="_top">'+s.title+'</a></h2><div class="entry-content">'+s.description+'</div></div></div><div class="embed-footer"><a href="'+a+'" target="_top"><img src="https://cdn-ak.favicon.st-hatena.com?url='+a+'" alt="'+s.site_name+'" title="'+s.site_name+'" class="favicon">'+s.site_name+'</a><img src="https://s.st-hatena.com/entry.count.image?uri='+a+'" alt="" class="star-count"><a href="http://b.hatena.ne.jp/entry/'+a+'" target="_top"><img src="https://b.hatena.ne.jp/entry/image/'+a+'" class="bookmark-count"></a></div>'}return g})(e,o,n)).then(t=>e.parentNode.replaceChild(t,e)).catch(e=>console.error("error"))}})}}var C=document.getElementsByClassName("imzMenu")[0];if(void 0!==C){var A=document.createElement("a");A.setAttribute("href","javascript:void(0);"),A.setAttribute("onclick","toggleoffcanvas();return false;"),A.classList.add("offcanvastoggle"),C.parentNode.insertBefore(A,C)}},e}();function smoothScroll(e){var t=window.pageYOffset,a=e>t;setTimeout(function(){a&&t<=e?(t=t+(e-t)/20+1,window.scrollTo(0,t),setTimeout(arguments.callee,10)):!a&&t>=e?(t=t-(t-e)/20-1,window.scrollTo(0,t),setTimeout(arguments.callee,10)):window.scrollTo(0,e)},10)}function scrollToContent(e){var t=document.getElementById(e.replace(/^#/,""));null!=t&&(smoothScroll(t.getBoundingClientRect().top+window.pageYOffset),document.body.classList.contains("offcanvas")&&toggleoffcanvas())}function toggleoffcanvas(){if(document.body.classList.contains("offcanvas"))document.body.classList.remove("offcanvas");else{document.body.classList.add("offcanvas");var e=document.getElementsByClassName("offcanvasmenu")[0];e.addEventListener("touchmove",function(t){var a=e.scrollTop,n=e.scrollHeight-e.offsetHeight-1;a<1?(t.preventDefault(),e.scrollTop=1):a>n&&(t.preventDefault(),e.scrollTop=n)})}}
